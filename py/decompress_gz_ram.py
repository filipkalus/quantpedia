from gzip import decompress
from json import loads
from requests import get
from json import loads
from io import BytesIO

files = [
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170630-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170629-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170628-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170627-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170626-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170625-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170624-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170623-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170622-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170621-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170620-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170619-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170618-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170617-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170616-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170615-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170614-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170613-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170612-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170611-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170610-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170609-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170608-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170607-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170606-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170605-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170604-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170603-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170602-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170601-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170531-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170530-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170529-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170528-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170527-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170526-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170525-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170524-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170523-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170522-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170521-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170520-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170519-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170518-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170517-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170516-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170515-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170514-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170513-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170512-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170511-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170510-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170509-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170508-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170507-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170506-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170505-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170504-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170503-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170502-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170501-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170430-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170429-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170428-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170427-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170426-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170425-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170424-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170423-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170422-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170421-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170420-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170419-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170418-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170417-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170416-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170415-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170414-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170413-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170412-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170411-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170410-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170409-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170408-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170407-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170406-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170405-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170404-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170403-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170402-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170401-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170331-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170330-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170329-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170328-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170327-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170326-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170325-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170324-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170323-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170322-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170321-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170320-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170319-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170318-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170317-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170316-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170315-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170314-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170313-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170312-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170311-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170310-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170309-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170308-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170307-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170306-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170305-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170304-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170303-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170302-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170301-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170228-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170227-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170226-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170225-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170224-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170223-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170222-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170221-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170220-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170219-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170218-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170217-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170216-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170215-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170214-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170213-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170212-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170211-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170210-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170209-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170208-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170207-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170206-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170205-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170204-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170203-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170202-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170201-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170131-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170130-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170129-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170128-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170127-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170126-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170125-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170124-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170123-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170122-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170121-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170120-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170119-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170118-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170117-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170116-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170115-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170114-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170113-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170112-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170111-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170110-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170109-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170108-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170107-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170106-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170105-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170104-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170103-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170102-CRYPTOCURRENCY',
'https://datamine.cmegroup.com/cme/api/v1/download?fid=20170101-CRYPTOCURRENCY'
]

output_path = 'btc/output.txt'

with open(output_path, 'a') as output_file:
    
    for url in files:
        print(url)
        filename = url.split("=")[-1].split('-')[0]
        filepath = 'btc/' + filename + '.txt'

        #print('downloading...')
        response = get(url, auth=('API_QUANTPEDIA', 'Jank0Hrask0'))
        if response.status_code == 200:
            data = (response.content)
            #print('decompressing to ram...')
            contents = decompress(data)
            
            output = BytesIO()
            output.write(contents)
            output.seek(0)
            contents = str(output.getvalue())
            #print(contents[:500])
            json_contents_strings = contents.split('\\n')
            #print(len(json_contents_strings))
            
            matched_line = [line for line in json_contents_strings if filename+'-22:00:00' in line and 'BRTI' in line and 'SecurityDefinition' not in line][0]
            json = loads(matched_line)
            entires = json['mdEntries'][0]
            price = entires['mdEntryPx']
            output_file.write('\n' + filename + ';' + str(price))
            output.close()
            
print('done')
